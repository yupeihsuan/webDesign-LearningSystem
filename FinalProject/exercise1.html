<!DOCTYPE html>
<html>
<head>
    <title>2-3-1練習題</title>
    <link rel="stylesheet" href="exercise.css">
    <script>

        function logoutUser() {
            window.location.href = "userLogin.html";
        }
        
        //題目、圖片、答案
        const questions = [
            {
                type: "radio_check",
                question: '下咧哪一組數字<font color=red>不是</font>直角三角形的邊長?',
                img: "tri.png",
                options:["(A) 7、24、25","(B) 3、4、5","(C) 5、13、14","(D) 8、15、17"],
                answer: ["(C) 5、13、14"],
                hint:[
                    "1.利用畢氏定理： a&sup2 + b&sup2 = c&sup2",
                    "2.將各個答案帶入：",
                    "(A) 7&sup2 + 24&sup2 = 625 = 25&sup2",
                    "(B) 3&sup2 + 4&sup2 = 25 = 5&sup2",
                    "(C) 5&sup2 + 12&sup2 = 169 &#8800 14&sup2",
                    "(D) 8&sup2 + 15&sup2 = 289 = 17&sup2",
                    "<hr>常見的直角三角形三邊長：<br>(3、4、5),(5、12、13),(7、24、25),(8、15、17)",
                ]
            },
            {
                type: "radio_check",
                question: '圖為一直角三角形，求出第三邊a的長度',
                img: "2.png",
                options:["(A) 13","(B) 14","(C) 12","(D) 18"],
                answer: ["(C) 12"],
                hint:[
                    "1.直角三角形的三邊長會滿足畢氏定理： a&sup2 + b&sup2 = c&sup2",
                    "2.5&sup2 + a&sup2 = 13&sup2",
                    "  25 + a&sup2 = 169",
                    "  a&sup2 = 169-25 = 144",
                    "  => a = 12",
                    "<hr>常見的直角三角形三邊長：<br>(3、4、5),(5、12、13),(7、24、25),(8、15、17)"
                ]
            },
            {
                type: "radio_check",
                question: '已知一直角三角形，其中斜邊為25，下列何者可能為其兩股?',
                img: "8.png",
                options:["(A) 10，16","(B) 13，13","(C) 20、24","(D) 7，24"],
                answer: ["(D) 7，24"],
                hint:[
                    "1.直角三角形的三邊長會滿足畢氏定理： a&sup2 + b&sup2 = c&sup2",
                    "2.將各個答案帶入：",
                    "(A) 10&sup2 + 16&sup2 = 356 &#8800 25&sup2",
                    "(B) 13&sup2 + 13&sup2 = 338 &#8800 25&sup2",
                    "(C) 20&sup2 + 24&sup2 = 976 &#8800 25&sup2",
                    "(D) 7&sup2 + 24&sup2 = 625 = 25&sup2"
                ]
            },
            {
                type: "radio_check",
                question: '圖為一直角三角形，求出第三邊a的長度',
                img: "3.png",
                options:["(A) 16","(B) 13","(C) 12","(D) 17"],
                answer: ["(D) 17"],
                hint:[
                    "1.直角三角形的三邊長會滿足畢氏定理： a&sup2 + b&sup2 = c&sup2",
                    "2.8&sup2 + 15&sup2 = a&sup2",
                    "  64 + 225 = 289",
                    "  => a = 17",
                    "<hr>常見的直角三角形三邊長：<br>(3、4、5),(5、12、13),(7、24、25),(8、15、17)"
                ]
            },
            {
                type: "radio_check",
                question: '直角三角形的斜邊長為30公分，一股長為24公分，請問另一股長是幾公分?',
                img: "7.png",
                options:["(A) 16","(B) 17","(C) 18","(D) 19"],
                answer: ["(C) 18"],
                hint:[
                    "1.直角三角形的三邊長會滿足畢氏定理： a&sup2 + b&sup2 = c&sup2",
                    "2.設另一股長為x，則 24&sup2 + x&sup2 = 30&sup2",
                    "3.x&sup2 = 30&sup2 - 24&sup2 = 900 - 576 = 324",
                    "4. x = 18"
                ]
            },
            {
                type: "radio_check",
                question: '直角三角形的斜邊長為25公分，一股長為7公分，請問另一股長是幾公分?',
                img: "23.png",
                options:["(A) 21","(B) 22","(C) 23","(D) 24"],
                answer: ["(D) 24"],
                hint:[
                    "1.直角三角形的三邊長會滿足畢氏定理： a&sup2 + b&sup2 = c&sup2",
                    "2.設另一股長為x，則 7&sup2 + x&sup2 = 25&sup2",
                    "3.x&sup2 = 25&sup2 - 7&sup2 = 625 - 49 = 576",
                    "4. x = 24"
                ]
            },
            {
                type: "radio_check",
                question: '直角三角形的一股長為9公分，另一股長為12公分，則其斜邊是幾公分?',
                img: "24.png",
                options:["(A) 15","(B) 16","(C) 17","(D) 18"],
                answer: ["(A) 15"],
                hint:[
                    "1.直角三角形的三邊長會滿足畢氏定理： a&sup2 + b&sup2 = c&sup2",
                    "2.設斜邊長為x，則 9&sup2 + 12&sup2 = x&sup2",
                    "3.x&sup2 = 81 + 144 = 225",
                    "4. x = 15"
                ]
            },
            {
                type: "radio_check",
                question: '直角三角形的斜邊長為10公分，一股長為6公分，請問另一股長是幾公分?',
                img: "25.png",
                options:["(A) 5","(B) 6","(C) 7","(D) 8"],
                answer: ["(D) 8"],
                hint:[
                    "1.直角三角形的三邊長會滿足畢氏定理： a&sup2 + b&sup2 = c&sup2",
                    "2.設另一股長為x，則 6&sup2 + x&sup2 = 10&sup2",
                    "3.x&sup2 = 10&sup2 - 6&sup2 = 100 - 36 = 64",
                    "4. x = 8"
                ]
            },
            {
                type: "radio_check",
                question: '下列以直角三角形三邊長為邊的正方形，求甲正方形的面積',
                img: "26.png",
                options:["(A) 22","(B) 23","(C) 24","(D) 25"],
                answer: ["(D) 25"],
                hint:[
                    "1.假設直角三角形的斜邊長是c，兩股長分別是a、b，則 a&sup2 + b&sup2 = c&sup2",
                    "2.直角三角形的各邊邊長正好是正方形的邊長",
                    "3.甲正方形的面積 = 3&sup2 + 4&sup2 = 25"
                ]
            }
            

        ];

        //出題模式
        var index=0;
        var score=0;
        
        var recordQue=[];   //預設題目為未作答
        for(var i=0;i<questions.length;i++){
            recordQue.push(false);
        }

        var wrongQue=[];    //記錄錯誤題目

        function showQue(){
            const questionDiv=document.getElementById('que');
            const picDiv=document.getElementById('pic');

            let optionsHtml="";
            if(questions[index].type=="radio_check"){
                for(var i=0;i<questions[index].options.length;i++){
                    var option=questions[index].options[i];
                    optionsHtml+=`<label><input type="radio" name="question${index}" class="optionInput" value="${option}">${option}</label><br>`;
                }
            }

            

            questionDiv.innerHTML=`
                <h3>第${index+1}題：</h3>
                <h4>${questions[index].question}</h4><br>
                ${optionsHtml||inputHtml}
                <button id="check" class="function_btn" onclick="checkAns();"}>送出答案</button>
                <button id="hint" class="function_btn" onclick="showHint();">提示</button>
                <br><br><span id="fb"></span>
            `;
            picDiv.innerHTML=`<img class="imgQue" src="${questions[index].img}" alt="題目圖片">`;
        }

        function showHint(){
            currentStep=0;
            const modalHtml=`
            <div id="hintModal" class="modal">
                <div class="modalContent">
                    <span class="close" onclick="closeModal();">&times;</span>
                    <h4>解題過程</h4>
                    <div id="hintStep">
                        <ul id="hintStepList"></ul>
                    </div>
                    <button id="autoStep" class="modal_btn" onclick="autoStep();">逐步顯示</button>
                    <button id="manualStep" class="modal_btn" onclick="nextStep();">下一步</button>
                    <button id="clearStep" class="modal_btn" onclick="clearStep();">清除</button>
                </div>
            </div>
            `;

            const modalContainer=document.createElement('div');
            modalContainer.innerHTML=modalHtml;
            document.body.appendChild(modalContainer);

            const hintList=document.getElementById('hintStepList');
            hintList.innerHTML="";
            for(var i=0;i<questions[index].hint.length;i++){
                hintList.innerHTML+=`<li id="hintStep${i}">${questions[index].hint[i]}</li>`;
            }
        }

        function clearStep(){
            clearInterval(stepInterval);
            currentStep=0;
            
            const hintList=document.getElementById('hintStepList');
                if(hintList){
                    for(var i=0;i<hintList.children.length;i++){
                        hintList.children[i].style.display='none';
                    }
                }
        }

        function nextStep(){
            const step=document.getElementById(`hintStep${currentStep}`);
            if(step){
                step.style.display='list-item';
                currentStep++;
            }else{
                alert("已經是最後一步了!");
            }
        }

        function closeModal(){
            const modal=document.getElementById('hintModal');
            if(modal){
                modal.remove();
            }
        }

        var currentStep=0;
        var stepInterval;

        function autoStep(){
            currentStep=0;
            clearInterval(stepInterval);

            stepInterval=setInterval(()=>{
                const step=document.getElementById(`hintStep${currentStep}`);
                if(step){
                    step.style.display='list-item';
                    currentStep++;
                }else{
                    clearInterval(stepInterval);
                }
            },1500);
        }

        var finishedQue=0;

        function checkAns(){
            const fb = document.getElementById('fb');
            const progressCircles = document.querySelectorAll('.progress-circle');
            
            let userAns;
            if(questions[index].type == "text" || questions[index].type == "textarea"){
                userAns = document.getElementById('ans').value.trim();
            } else if(questions[index].type == "singleList"){
                userAns = document.getElementById('singleList').value;
            } else {
                const selectedOptions = Array.from(document.querySelectorAll('.optionInput:checked')).map(el => el.value);
                userAns = selectedOptions;
            }

            if (questions[index].type == "radio_check") {
                if (JSON.stringify(userAns.sort()) == JSON.stringify(questions[index].answer.sort())) {
                    fb.style.color = "#4caf50";
                    fb.innerHTML = '<img src="correct.jpg" class="fbImg">答對了!!!';
                    // document.getElementById('check').disabled = true;
                    // document.querySelectorAll('.optionInput').forEach(el => el.disabled = true);
                    progressCircles[index].classList.add('correct');
                    finishedQue++;
                    
                    // 儲存圓圈狀態到 localStorage
                    localStorage.setItem(`circle${index}`, 'correct');

                    if(finishedQue==questions.length){
                        localStorage.setItem('exercise1Completed','true');
                    }
                } else {
                    fb.style.color = "#f44336";
                    fb.innerHTML = '<img src="wrong.jpg" class="fbImg">答錯了!!!';
                    
                    // 儲存圓圈狀態到 localStorage
                    localStorage.setItem(`circle${index}`, 'wrong');
                }
            } else {
                if (JSON.stringify(userAns) == JSON.stringify(questions[index].answer)) {
                    fb.style.color = "#4caf50";
                    fb.innerHTML = '<img src="correct.jpg" class="fbImg">答對了!!!';
                    // document.getElementById('check').disabled = true;
                    // document.querySelectorAll('.optionInput').forEach(el => el.disabled = true);
                    progressCircles[index].classList.add('correct');
                    finishedQue++;
                    
                    // 儲存圓圈狀態到 localStorage
                    localStorage.setItem(`circle${index}`, 'correct');
                } else {
                    fb.style.color = "#f44336";
                    fb.innerHTML = '<img src="wrong.jpg" class="fbImg">答錯了!!!';
                    
                    // 儲存圓圈狀態到 localStorage
                    localStorage.setItem(`circle${index}`, 'wrong');
                }
            }

            recordQue[index] = true;
        }

        function nextQue() {
            document.getElementById('fb').innerHTML="";
            if (index < questions.length - 1) {
                index++;
                showQue();
            } else{
                // 顯示完成按鈕
                alert("已經是最後一題了!可以前往下一個單元繼續學習");
                
                document.getElementById("prevQue").style.display = "none"; 
                document.getElementById("nextQue").style.display = "none"; 
                document.getElementById("tryAgain").style.display = "block"; 
                document.getElementById("finishBtn").style.display = "block"; 
            }
        }

        function prevQue() {
            if (index > 0) {
                index--;
                showQue();
            }
        }

        //計時模式
        var sec=0;
        var timerId;

        function countdown(){
            sec++;            
        }

        function goToFeedback(){
            window.location.href = "exercise2.html";
        }

        function tryAgain(){
            window.location.href = 'exercise1.html';
        }

        
        // 初始化進度條圓圈的顯示
        function initializeProgressBar() {
            const progressBar = document.getElementById('progressBar');
            const progressCircles = [];
            questions.forEach(() => {
                const circle = document.createElement('div');
                circle.className = 'progress-circle';
                progressBar.appendChild(circle);
                progressCircles.push(circle);
            });

            // 從 localStorage 讀取並更新圓圈的狀態
            for (let i = 0; i < questions.length; i++) {
                //const storedStatus = localStorage.getItem(`circle${i}`);
                const circle = progressCircles[i];
                if (storedStatus === 'correct') {
                    circle.classList.add('correct');
                } else if (storedStatus === 'wrong') {
                    circle.classList.add('wrong');
                }
            }
        }

        // 顯示作答規則的提示框
        function showRules() {
            const rulesModalHtml = `
                <div id="rulesModal" class="Rulemodal">
                    <div class="RuleModalContent">
                        <span class="RuleClose" onclick="closeRulesModal();">&times;</span>
                        <h4>練習區作答規則</h4>
                        <p>1. 根據題目選擇正確答案。</p>
                        <p>2. 答對後，右上圓圈顯示綠色。</p>
                        <p>3. 點擊<strong style="color: red">「提示」</strong>查看提示。</p>
                        <p>4. 點擊<strong style="color: red">「送出答案」</strong>查看作答結果。</p>
                        <p>5. 作答完成可進入下一單元。</p>
                        <p>6. 所有圓圈變成綠色，<strong>學習回饋</strong>頁會顯示「完成」。</p>
                    </div>
                </div>
            `;
            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = rulesModalHtml;
            document.body.appendChild(modalContainer);
        }

        // 關閉提示框
        function closeRulesModal() {
            const modal = document.getElementById('rulesModal');
            if (modal) {
                modal.remove();
            }
        }

        window.onload = function() {
            showRules()
            document.getElementById('usernameText').innerHTML = localStorage.getItem("loggedInUser");
            showQue();
            initializeProgressBar();

            const isCompleted = localStorage.getItem('exercise1Completed');
        };
    </script>
</head>
    <body>
        <header>
            <div class="menu">
                <ul class="drop-down-menu">
                    <li><a href="homePage.html">首頁</a></li>
                    <li><a href="totalClass.html">課程</a>
                        <ul>
                            <li><a href="">發現畢氏定理</a>
                                <ul>
                                    <li><a href="ch11.html">直角三角形的定義及名稱</a></li>
                                    <li><a href="ch12.html">畢氏定理(或商高定理、勾股定理)</a></li>
                                </ul>
                            </li>
                            <li><a href="">畢氏定理的應用</a>
                                <ul>
                                    <li><a href="ch21.html">利用畢氏定理求矩形的對角線長</a></li>
                                    <li><a href="ch22.html">直角三角形斜邊上的高</a></li>
                                    <li><a href="ch23.html">畢氏定理的生活應用</a></li>
                                </ul>
                            </li>
                            <li><a href="">直角坐標平面上兩點的距離公式</a>
                                <ul>
                                    <li><a href="ch31.html">數線上的兩點距離</a></li>
                                    <li><a href="ch32.html">直角座標平面上兩點的距離</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><a href="exercise1.html">練習區</a>
                        <ul>
                            <li><a href="exercise1.html">發現畢氏定理</a></li>
                            <li><a href="exercise2.html">畢氏定理的應用</a></li>
                            <li><a href="exercise3.html">直角坐標平面上兩點的距離公式</a></li>
                        </ul>
                    </li>
                    <li><a href="challenge.html">挑戰區</a></li>

                    <li><a href="feedback.html">學習回饋</a></li>
                </ul>
            </div>

            
            <div class="username-display" id="usernameDisplay">
                <img src="profile.png" alt="使用者圖片">
                <div class="dropdown">
                    <span id="usernameText">使用者</span>
                    <ul class="dropdown-menu">
                        <li><a href="#" onclick="logoutUser();">登出</a></li>
                    </ul>
                </div>
            </div>
        </header>

        <main>
            <div class="box">
                <div class="content">
                    <h2>練習題1 - 發現畢氏定理</h2>
                    <div class="feedback">
                        <div id="progressBar" class="progress-bar"></div>
                    </div>
                    <hr>
                    <div class="Question">
                        <div id="que">題目</div>
                        <div id="pic">圖片</div>
                    </div>
                    
    
                    <div class="btn">
                        <button id="prevQue" onclick="prevQue();">上一題</button>
                        <button id="nextQue" onclick="nextQue();">下一題</button>
                        <button id="tryAgain" onclick="tryAgain();" style="display: none;">再練習一次</button>
                        <button id="finishBtn" onclick="goToFeedback();" style="display: none;">前往下一單元</button>
                    </div>
    
                    
                    
                </div>
            </div>

            
        </main>
        

        
    </body>
</html>